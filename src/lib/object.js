const e="$@extract@$",t="$@origin@$",n=new WeakMap,r=new WeakMap,c=(e,t)=>("function"==typeof t?((e,t)=>{r.has(e)||r.set(e,new WeakMap);const n=r.get(e);if(!n.has(t)){const r=t?.bind?.(e);n.set(t,r)}return n.get(t)})(e,t):t)??t,o=e=>"function"==typeof e?.[Symbol.iterator],a=(e,t,n,r)=>{if(e instanceof Map||e instanceof WeakMap){if(null!=t&&e.has(t))return n?.(e.get(t),t)}else if(e instanceof Set||e instanceof WeakSet){if(null!=t&&e.has(t))return n?.(t,t)}else if("function"==typeof e||"object"==typeof e)return n?.(Reflect.get(e,t,r??e),t)},s=n=>{const r="object"==typeof n||"function"==typeof n?n?.[e]??n:n,c=e=>s(e);return Array.isArray(r)?r?.map?.(c)||Array.from(r||[])?.map?.(c)||[]:r instanceof Map||r instanceof WeakMap?new Map(Array.from(r?.entries?.()||[])?.map?.((([e,t])=>[e,s(t)]))):r instanceof Set||r instanceof WeakSet?new Set(Array.from(r?.values?.()||[])?.map?.(c)):null!=r&&"function"==typeof r||"object"==typeof r?Object.fromEntries(Array.from(Object.entries(r||{})||[])?.filter?.((([n])=>n!=e&&n!=t))?.map?.((([e,t])=>[e,s(t)]))):r},f=(e,t,n=null)=>{const r=null==n||"object"!=typeof e&&"function"!=typeof e?e:e?.[n]??e;let c=[];t instanceof Set||t instanceof Map||Array.isArray(t)||o(t)?c=(r instanceof Set||r instanceof WeakSet?t?.values?.():t?.entries?.())||(Array.isArray(t)||o(t)?t:[]):"object"!=typeof t&&"function"!=typeof t||(c=r instanceof Set||r instanceof WeakSet?Object.values(t):Object.entries(t));let a=[];Array.isArray(r)?a=r.entries():r instanceof Map||r instanceof WeakMap?a=r?.entries?.():r instanceof Set||r instanceof WeakSet?a=r?.values?.():"object"!=typeof r&&"function"!=typeof r||(a=Object.entries(r));const s=new Set(Array.from(c).map((e=>e?.[0]))),f=new Set(Array.from(a).map((e=>e?.[0]))),i=s?.difference?.(f);if(Array.isArray(r)){const e=r.filter(((e,t)=>!i.has(t)));r.splice(0,r.length),r.push(...e)}else if(r instanceof Map||r instanceof WeakMap)for(const e of i)r.delete(e);else if(r instanceof Set||r instanceof WeakSet)for(const e of i)r.delete(e);else if("function"==typeof r||"object"==typeof r)for(const e of i)delete r[e];return r},i=(e,t="id")=>{const n=Array.from(e?.values?.()).map((e=>[e?.[t],e])),r=new Map(n);return Array.from(r?.values?.()||[])},l=(e,t,n=null,r=1,c="id")=>{const a=null==n||"object"!=typeof e&&"function"!=typeof e?e:e?.[n]??e;let s=[];if(r&&f(a,t),t instanceof Set||t instanceof Map||Array.isArray(t)||o(t)?s=(a instanceof Set||a instanceof WeakSet?t?.values?.():t?.entries?.())||(Array.isArray(t)||o(t)?t:[]):"object"!=typeof t&&"function"!=typeof t||(s=a instanceof Set||a instanceof WeakSet?Object.values(t):Object.entries(t)),a&&s&&("object"==typeof s||"function"==typeof s)){if(a instanceof Map||a instanceof WeakMap){for(const e of s)a.set(...e);return a}if(a instanceof Set||a instanceof WeakSet){for(const e of s){const t=e?.[c]?Array.from(a?.values?.()||[]).find((t=>t?.[c]==e?.[c])):null;t?l(t,e,null,r,c):a.add(e)}return a}if("object"==typeof a||"function"==typeof a){if(Array.isArray(a)||o(a)){let e=0;for(const t of s)a.length>e?a[e++]=t?.[1]:a?.push?.(t?.[1]);return a}return Object.assign(a,Object.fromEntries([...s||[]]))}}return null!=n?(Reflect.set(e,n,t),e):"object"==typeof t||"function"==typeof t?Object.assign(e,t):t};class u{constructor(){}get(n,r,c){return r==e||r==t?n?.[r]??n:Reflect.get(n,r,c)}construct(e,t,n){return Reflect.construct(e,t,n)}has(e,t){return Reflect.has(e,t)}apply(e,t,n){return Reflect.apply(e,t,n)}set(e,t,n){return l(e,n,t),1}deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}const y=e=>{const t=new Proxy(e,new u);return n.set(t,e),t};class p{subscribers;listeners;constructor(){this.subscribers=new Map,this.listeners=new Set}subscribe(e,t){null!=t?this.subscribers.has(t)?this.subscribers.get(t)?.add?.(e):this.subscribers.set(t,new Set([e])):this.listeners.has(e)||this.listeners.add?.(e)}trigger(e,t=null,n){Array.from(this.subscribers.get(e)?.values?.()||[]).forEach((r=>r(t,e,n))),Array.from(this.listeners?.values?.()||[]).forEach((r=>r(t,e,n)))}}const b=new WeakMap,w=(t,n)=>{const r=t?.[e]??t;return b.has(r)||b.set(r,new p),n},j=(e,t,n=()=>"")=>{A(t,((t,r)=>{r==n()&&l(e,t,null,1)}))},S=(e,t,n)=>(A(t,((t,n)=>{l(e,t,n,1)})),n?.((()=>e),(e=>{for(const n in e)l(t,e[n],n,1)}),{deep:1}),e),R=(e,t,n)=>S(t(s(e)),e,n),A=(r,c,s=null)=>{const f=Array.isArray(r)&&2==r?.length&&["object","function"].indexOf(typeof r?.[0])>=0&&(e=>["symbol","string","number"].indexOf(typeof e)>=0)(r?.[1]),i=f?r?.[1]:null,l="object"==typeof(r=n.get(r=f&&null!=i?r?.[0]??r:r)??r?.[t]??r)||"function"==typeof r?r?.[e]??r:r;null!=i?a(l,i,c,s):((e,t,n)=>{let r=[];e instanceof Set||e instanceof Map||Array.isArray(e)||o(e)||"function"==typeof e?.keys?r=e?.keys?.()||[]:"object"!=typeof e&&"function"!=typeof e||null==e||(r=Object.keys(e)||[]),null!=r&&Array.from(r)?.map?.((r=>a(e,r,t,n)))})(l,c,s);const u=b.get(l);return u?.subscribe?.(c,i),u};class k{constructor(){}has(e,t){return Reflect.has(e,t)}get(n,r,o){if(r==e||r==t)return n?.[r]??n;const a=c(n,Reflect.get(n,r,o));return"delete"==r?(e,t=null)=>{const r=n.get(e),c=a(e);return b.get(n)?.trigger?.(e,null,r),c}:"set"==r?(e,t)=>{const r=n.get(e),c=a(e,t);return b.get(n)?.trigger?.(e,t,r),c}:a}construct(e,t,n){return Reflect.construct(e,t,n)}apply(e,t,n){return Reflect.apply(e,t,n)}}class M{constructor(){}has(e,t){return Reflect.has(e,t)}get(t,n,r){if(n==e)return t?.[e]??t;const o=c(t,Reflect.get(t,n,r));return"delete"==n?e=>{const n=t.has(e)?e:null,r=o(e);return b.get(t)?.trigger?.(e,null,n),r}:"add"==n?e=>{const n=t.has(e)?e:null,r=o(e);return b.get(t)?.trigger?.(e,e,n),r}:o}construct(e,t,n){return Reflect.construct(e,t,n)}apply(e,t,n){return Reflect.apply(e,t,n)}}class h{constructor(){}get(t,n,r){return n==e?t?.[e]??t:c(t,Reflect.get(t,n,r))}construct(e,t,n){return Reflect.construct(e,t,n)}has(e,t){return Reflect.has(e,t)}apply(e,t,n){return Reflect.apply(e,t,n)}set(e,t,n){const r=e[t],c=Reflect.set(e,t,n),o=b.get(e);return o?.trigger?.(t,n,r),c}deleteProperty(e,t){const n=e[t],r=Reflect.deleteProperty(e,t),c=b.get(e);return c?.trigger?.(t,null,n),r}}const m=t=>new Proxy(t?.[e]??t,w(t,new h)),d=t=>new Proxy(t?.[e]??t,w(t,new k)),W=t=>new Proxy(t?.[e]??t,w(t,new M)),g=(e=[])=>new Proxy(new Map(e),w(e,new k)),O=(e=[])=>new Proxy(new Set(e),w(e,new M)),v=(t,n="")=>{const r="object"==typeof t||"function"==typeof t?t?.[e]??t:t;let c=t;return r instanceof Map||r instanceof WeakMap?c=d(t):r instanceof Set||r instanceof WeakSet?c=W(t):"function"!=typeof r&&"object"!=typeof r||(c=m(t)),c},P=(t,n="")=>{const r="object"==typeof t||"function"==typeof t?t?.[e]??t:t;let c=t;return Array.isArray(t)||"function"!=typeof r&&"object"!=typeof r||(c=m(t)),c},x=()=>crypto?.randomUUID?crypto?.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16)));class ${#e=0;static looping=new Map([]);static registry=new FinalizationRegistry((e=>{$.looping.delete(e)}));constructor(){this.#e=0}available(e,t=()=>1){const n=performance.now();return n-this.#e>=e&&t()?(this.#e=n,1):0}static symbol(e=""){const t=Symbol(e||"switch");return document[t]=1,t}static async rafLoop(e,t=document){const n=x();try{$.looping.set(n,e)}catch(e){console.warn(e)}if(null!=t)try{$?.registry?.register?.(t,n)}catch(e){console.warn(e)}return 0}static get raf(){return new Promise((e=>requestIdleCallback(e)))}static protect(e,t=100){return(new $).protect(e,t)}static cached(e,t=100){return(new $).cached(e,t)}cached(e,t=100){let n=null;return(...r)=>this.available(t)||null==n?n=e(...r):n}protect(e,t=100){return(...n)=>this.available(t)?e(...n):null}}const q=new $;requestIdleCallback((async()=>{for(;;)await Promise.allSettled(Array.from($.looping.values()).map((e=>e?.(performance.now())))),await new Promise((e=>requestAnimationFrame(e)))}),{timeout:100});export{u as AssignObjectHandler,k as ReactiveMap,h as ReactiveObject,M as ReactiveSet,p as Subscript,$ as Time,x as UUIDv4,j as bindByKey,S as bindWith,P as createReactive,g as createReactiveMap,O as createReactiveSet,q as defaultTimer,R as derivate,y as makeObjectAssignable,v as makeReactive,d as makeReactiveMap,m as makeReactiveObject,W as makeReactiveSet,i as mergeByKey,l as objectAssign,f as removeExtra,s as safe,A as subscribe};